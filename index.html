<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>WP+WC Conductor Performance Logger</title>
  <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
  <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect } = React;

    const Plus = () => (
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
        <line x1="12" y1="5" x2="12" y2="19"></line>
        <line x1="5" y1="12" x2="19" y2="12"></line>
      </svg>
    );

    const Edit2 = () => (
      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
        <path d="M17 3a2.828 2.828 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3z"></path>
      </svg>
    );

    const Trash2 = () => (
      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
        <polyline points="3 6 5 6 21 6"></polyline>
        <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
      </svg>
    );

    const Download = () => (
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
        <polyline points="7 10 12 15 17 10"></polyline>
        <line x1="12" y1="15" x2="12" y2="3"></line>
      </svg>
    );

    const Search = () => (
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
        <circle cx="11" cy="11" r="8"></circle>
        <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
      </svg>
    );

    const X = () => (
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
        <line x1="18" y1="6" x2="6" y2="18"></line>
        <line x1="6" y1="6" x2="18" y2="18"></line>
      </svg>
    );

    function ConductorLogManager() {
      const [logs, setLogs] = useState([]);
      const [isModalOpen, setIsModalOpen] = useState(false);
      const [editingLog, setEditingLog] = useState(null);
      const [searchTerm, setSearchTerm] = useState('');
      const [projectSuggestions, setProjectSuggestions] = useState([]);
      const [showSuggestions, setShowSuggestions] = useState(false);
      const [formData, setFormData] = useState({
        session: '',
        date: '',
        project: '',
        stage: '',
        query: '',
        timeTaken: '',
        complexity: '',
        wins: '',
        fails: '',
        tweak: ''
      });

      const stages = [
        'Stage 1 – Initial setup',
        'Stage 2 – Cart/checkout',
        'Stage 3 – Products',
        'Stage 4 – Payments',
        'Stage 5 – Shipping',
        'Stage 6 – Customization',
        'Stage 7 – Testing/launch'
      ];

      const complexityLevels = ['Low', 'Medium', 'High'];
      const timeBuckets = ['5m', '15m', '30m+', '1h+'];

      useEffect(() => {
        loadLogs();
      }, []);

      const loadLogs = () => {
        try {
          const stored = localStorage.getItem('conductor-logs-v2');
          if (stored) {
            setLogs(JSON.parse(stored));
          }
        } catch (error) {
          console.log('No existing logs found, starting fresh');
        }
      };

      const saveLogs = (newLogs) => {
        try {
          localStorage.setItem('conductor-logs-v2', JSON.stringify(newLogs));
          setLogs(newLogs);
        } catch (error) {
          console.error('Failed to save logs:', error);
          alert('Failed to save data. Please try again.');
        }
      };

      const handleSubmit = (e) => {
        e.preventDefault();
        
        if (!formData.session || !formData.date || !formData.project || !formData.stage || 
            !formData.query || !formData.timeTaken || !formData.complexity) {
          alert('Please fill in all required fields');
          return;
        }
        
        if (editingLog !== null) {
          const updatedLogs = logs.map((log, index) => 
            index === editingLog ? { ...formData } : log
          );
          saveLogs(updatedLogs);
        } else {
          saveLogs([...logs, { ...formData }]);
        }
        
        resetForm();
      };

      const handleEdit = (index) => {
        setEditingLog(index);
        setFormData(logs[index]);
        setIsModalOpen(true);
      };

      const handleDelete = (index) => {
        if (window.confirm('Are you sure you want to delete this log entry?')) {
          const updatedLogs = logs.filter((_, i) => i !== index);
          saveLogs(updatedLogs);
        }
      };

      const resetForm = () => {
        const nextSession = logs.length > 0 ? 
          Math.max(...logs.map(log => parseInt(log.session) || 0)) + 1 : 1;
        const today = new Date().toISOString().split('T')[0];
        
        setFormData({
          session: nextSession.toString(),
          date: today,
          project: '',
          stage: '',
          query: '',
          timeTaken: '',
          complexity: '',
          wins: '',
          fails: '',
          tweak: ''
        });
        setEditingLog(null);
        setIsModalOpen(false);
        setShowSuggestions(false);
      };

      const openNewLogModal = () => {
        const nextSession = logs.length > 0 ? 
          Math.max(...logs.map(log => parseInt(log.session) || 0)) + 1 : 1;
        const today = new Date().toISOString().split('T')[0];
        
        setFormData({
          session: nextSession.toString(),
          date: today,
          project: '',
          stage: '',
          query: '',
          timeTaken: '',
          complexity: '',
          wins: '',
          fails: '',
          tweak: ''
        });
        setIsModalOpen(true);
      };

      const handleProjectChange = (value) => {
        setFormData({ ...formData, project: value });
        
        if (value.length > 0) {
          const uniqueProjects = [...new Set(logs.map(log => log.project))];
          const filtered = uniqueProjects.filter(p => 
            p.toLowerCase().includes(value.toLowerCase())
          );
          setProjectSuggestions(filtered);
          setShowSuggestions(filtered.length > 0);
        } else {
          setShowSuggestions(false);
        }
      };

      const selectProject = (project) => {
        setFormData({ ...formData, project });
        setShowSuggestions(false);
      };

      const exportToCSV = () => {
        const headers = ['Session #', 'Date', 'Project/Client', 'Stage', 'Query', 'Time Taken', 'Complexity', 'Wins', 'Fails', 'Tweak'];
        const rows = logs.map(log => [
          log.session,
          log.date,
          log.project,
          log.stage,
          log.query,
          log.timeTaken,
          log.complexity,
          log.wins || '',
          log.fails || '',
          log.tweak || ''
        ]);
        
        const csv = [
          headers.join(','),
          ...rows.map(row => row.map(cell => `"${cell}"`).join(','))
        ].join('\n');
        
        const blob = new Blob([csv], { type: 'text/csv' });
        const url = window.URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `conductor-logs-${new Date().toISOString().split('T')[0]}.csv`;
        a.click();
      };

      const filteredLogs = logs.filter(log =>
        [log.project, log.stage, log.query, log.wins, log.fails, log.tweak]
          .some(value => value && value.toString().toLowerCase().includes(searchTerm.toLowerCase()))
      );

      const getProjectStats = () => {
        const projectMap = {};
        logs.forEach(log => {
          if (!projectMap[log.project]) {
            projectMap[log.project] = 0;
          }
          projectMap[log.project]++;
        });
        return projectMap;
      };

      const getAverageTime = () => {
        if (logs.length === 0) return '0m';
        const timeValues = { '5m': 5, '15m': 15, '30m+': 30, '1h+': 60 };
        const totalMinutes = logs.reduce((sum, log) => sum + (timeValues[log.timeTaken] || 0), 0);
        const avg = Math.round(totalMinutes / logs.length);
        if (avg < 10) return `${avg}m`;
        if (avg < 30) return `~${Math.round(avg/5)*5}m`;
        if (avg < 60) return '30m+';
        return '1h+';
      };

      const projectStats = getProjectStats();
      const averageTime = getAverageTime();

      return (
        <div className="min-h-screen bg-gradient-to-br from-slate-50 to-slate-100 p-6">
          <div className="max-w-7xl mx-auto">
            <div className="bg-white rounded-lg shadow-sm p-6 mb-6">
              <div className="flex items-center justify-between mb-4">
                <div>
                  <h1 className="text-3xl font-bold text-slate-900">WP+WC Conductor Logger</h1>
                  <p className="text-slate-600 mt-1">Track AI conductor performance across client projects</p>
                </div>
                <button
                  onClick={openNewLogModal}
                  className="flex items-center gap-2 bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors"
                >
                  <Plus />
                  Add Log
                </button>
              </div>

              <div className="flex gap-3">
                <div className="flex-1 relative">
                  <div className="absolute left-3 top-1/2 transform -translate-y-1/2 text-slate-400">
                    <Search />
                  </div>
                  <input
                    type="text"
                    placeholder="Search projects, stages, queries..."
                    value={searchTerm}
                    onChange={(e) => setSearchTerm(e.target.value)}
                    className="w-full pl-10 pr-4 py-2 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                  />
                </div>
                <button
                  onClick={exportToCSV}
                  disabled={logs.length === 0}
                  className="flex items-center gap-2 bg-slate-600 text-white px-4 py-2 rounded-lg hover:bg-slate-700 transition-colors disabled:bg-slate-300 disabled:cursor-not-allowed"
                >
                  <Download />
                  Export CSV
                </button>
              </div>
            </div>

            {logs.length > 0 && (
              <div className="grid grid-cols-2 md:grid-cols-4 gap-3 mb-6">
                <div className="bg-white rounded-lg shadow-sm p-4">
                  <p className="text-slate-600 text-xs font-medium mb-1">Total Sessions</p>
                  <p className="text-2xl font-bold text-slate-900">{logs.length}</p>
                </div>
                <div className="bg-white rounded-lg shadow-sm p-4">
                  <p className="text-slate-600 text-xs font-medium mb-1">Avg Time</p>
                  <p className="text-2xl font-bold text-blue-600">{averageTime}</p>
                </div>
                <div className="bg-white rounded-lg shadow-sm p-4 col-span-2">
                  <p className="text-slate-600 text-xs font-medium mb-2">Sessions by Project</p>
                  <div className="flex flex-wrap gap-2">
                    {Object.entries(projectStats).map(([project, count]) => (
                      <span key={project} className="text-xs bg-slate-100 px-2 py-1 rounded">
                        {project}: <span className="font-semibold">{count}</span>
                      </span>
                    ))}
                  </div>
                </div>
              </div>
            )}

            <div className="bg-white rounded-lg shadow-sm overflow-hidden">
              {filteredLogs.length === 0 ? (
                <div className="text-center py-12 text-slate-500">
                  <p className="text-lg">No logs found</p>
                  <p className="text-sm mt-2">Click "Add Log" to create your first entry</p>
                </div>
              ) : (
                <div className="overflow-x-auto">
                  <table className="w-full text-sm">
                    <thead className="bg-slate-50 border-b border-slate-200">
                      <tr>
                        <th className="text-left px-2 py-3 text-xs font-semibold text-slate-700 w-16">Session</th>
                        <th className="text-left px-2 py-3 text-xs font-semibold text-slate-700 w-24">Date</th>
                        <th className="text-left px-2 py-3 text-xs font-semibold text-slate-700">Project</th>
                        <th className="text-left px-2 py-3 text-xs font-semibold text-slate-700">Stage</th>
                        <th className="text-left px-2 py-3 text-xs font-semibold text-slate-700">Query</th>
                        <th className="text-left px-2 py-3 text-xs font-semibold text-slate-700 w-16">Time</th>
                        <th className="text-left px-2 py-3 text-xs font-semibold text-slate-700 w-20">Level</th>
                        <th className="text-left px-2 py-3 text-xs font-semibold text-slate-700">Wins</th>
                        <th className="text-left px-2 py-3 text-xs font-semibold text-slate-700">Fails</th>
                        <th className="text-left px-2 py-3 text-xs font-semibold text-slate-700">Tweak</th>
                        <th className="text-right px-2 py-3 text-xs font-semibold text-slate-700 w-20">Actions</th>
                      </tr>
                    </thead>
                    <tbody className="divide-y divide-slate-200">
                      {filteredLogs.map((log, index) => (
                        <tr key={index} className="hover:bg-slate-50 transition-colors">
                          <td className="px-2 py-3 text-slate-900">{log.session}</td>
                          <td className="px-2 py-3 text-slate-900 text-xs">{log.date}</td>
                          <td className="px-2 py-3 text-slate-900 max-w-[120px] truncate" title={log.project}>{log.project}</td>
                          <td className="px-2 py-3 text-slate-900 text-xs max-w-[140px] truncate" title={log.stage}>{log.stage}</td>
                          <td className="px-2 py-3 text-slate-900 max-w-[160px] truncate" title={log.query}>{log.query}</td>
                          <td className="px-2 py-3 text-slate-900 text-xs">{log.timeTaken}</td>
                          <td className="px-2 py-3">
                            <span className={`inline-block px-2 py-0.5 rounded text-xs font-medium ${
                              log.complexity === 'Low' ? 'bg-green-100 text-green-700' :
                              log.complexity === 'Medium' ? 'bg-yellow-100 text-yellow-700' :
                              'bg-red-100 text-red-700'
                            }`}>
                              {log.complexity}
                            </span>
                          </td>
                          <td className="px-2 py-3 text-slate-900 max-w-[120px] truncate" title={log.wins || ''}>{log.wins || '—'}</td>
                          <td className="px-2 py-3 text-slate-900 max-w-[120px] truncate" title={log.fails || ''}>{log.fails || '—'}</td>
                          <td className="px-2 py-3 text-slate-900 max-w-[120px] truncate" title={log.tweak || ''}>{log.tweak || '—'}</td>
                          <td className="px-2 py-3 text-right">
                            <button
                              onClick={() => handleEdit(logs.indexOf(log))}
                              className="text-blue-600 hover:text-blue-800 p-1 mr-1"
                              title="Edit"
                            >
                              <Edit2 />
                            </button>
                            <button
                              onClick={() => handleDelete(logs.indexOf(log))}
                              className="text-red-600 hover:text-red-800 p-1"
                              title="Delete"
                            >
                              <Trash2 />
                            </button>
                          </td>
                        </tr>
                      ))}
                    </tbody>
                  </table>
                </div>
              )}
            </div>
          </div>

          {isModalOpen && (
            <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
              <div className="bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto">
                <div className="flex items-center justify-between p-6 border-b border-slate-200 sticky top-0 bg-white">
                  <h2 className="text-xl font-bold text-slate-900">
                    {editingLog !== null ? 'Edit Log Entry' : 'Add New Log Entry'}
                  </h2>
                  <button onClick={resetForm} className="text-slate-400 hover:text-slate-600">
                    <X />
                  </button>
                </div>

                <div className="p-6">
                  <div className="grid grid-cols-2 gap-4">
                    <div>
                      <label className="block text-sm font-medium text-slate-700 mb-1">
                        Session # <span className="text-red-500">*</span>
                      </label>
                      <input
                        type="text"
                        value={formData.session}
                        onChange={(e) => setFormData({ ...formData, session: e.target.value })}
                        className="w-full px-3 py-2 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                        placeholder="1"
                      />
                    </div>

                    <div>
                      <label className="block text-sm font-medium text-slate-700 mb-1">
                        Date <span className="text-red-500">*</span>
                      </label>
                      <input
                        type="date"
                        value={formData.date}
                        onChange={(e) => setFormData({ ...formData, date: e.target.value })}
                        className="w-full px-3 py-2 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                      />
                    </div>

                    <div className="col-span-2 relative">
                      <label className="block text-sm font-medium text-slate-700 mb-1">
                        Project / Client <span className="text-red-500">*</span>
                      </label>
                      <input
                        type="text"
                        value={formData.project}
                        onChange={(e) => handleProjectChange(e.target.value)}
                        onFocus={() => {
                          if (formData.project.length > 0) {
                            const uniqueProjects = [...new Set(logs.map(log => log.project))];
                            const filtered = uniqueProjects.filter(p => 
                              p.toLowerCase().includes(formData.project.toLowerCase())
                            );
                            setProjectSuggestions(filtered);
                            setShowSuggestions(filtered.length > 0);
                          }
                        }}
                        onBlur={() => setTimeout(() => setShowSuggestions(false), 200)}
                        className="w-full px-3 py-2 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                        placeholder="Client1 – Porto shop"
                      />
                      {showSuggestions && projectSuggestions.length > 0 && (
                        <div className="absolute z-10 w-full mt-1 bg-white border border-slate-300 rounded-lg shadow-lg max-h-40 overflow-y-auto">
                          {projectSuggestions.map((project, idx) => (
                            <div
                              key={idx}
                              onClick={() => selectProject(project)}
                              className="px-3 py-2 hover:bg-blue-50 cursor-pointer text-sm"
                            >
                              {project}
                            </div>
                          ))}
                        </div>
                      )}
                    </div>

                    <div>
                      <label className="block text-sm font-medium text-slate-700 mb-1">
                        Stage <span className="text-red-500">*</span>
                      </label>
                      <select
                        value={formData.stage}
                        onChange={(e) => setFormData({ ...formData, stage: e.target.value })}
                        className="w-full px-3 py-2 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                      >
                        <option value="">Select stage...</option>
                        {stages.map(stage => (
                          <option key={stage} value={stage}>{stage}</option>
                        ))}
                      </select>
                    </div>

                    <div>
                      <label className="block text-sm font-medium text-slate-700 mb-1">
                        Time Taken <span className="text-red-500">*</span>
                      </label>
                      <select
                        value={formData.timeTaken}
                        onChange={(e) => setFormData({ ...formData, timeTaken: e.target.value })}
                        className="w-full px-3 py-2 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                      >
                        <option value="">Select time...</option>
                        {timeBuckets.map(time => (
                          <option key={time} value={time}>{time}</option>
                        ))}
                      </select>
                    </div>

                    <div className="col-span-2">
                      <label className="block text-sm font-medium text-slate-700 mb-1">
                        Query <span className="text-red-500">*</span>
                      </label>
                      <input
                        type="text"
                        value={formData.query}
                        onChange={(e) => setFormData({ ...formData, query: e.target.value })}
                        className="w-full px-3 py-2 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                        placeholder="Fix cart page layout issue"
                      />
                    </div>

                    <div className="col-span-2">
                      <label className="block text-sm font-medium text-slate-700 mb-1">
                        Complexity <span className="text-red-500">*</span>
                      </label>
                      <div className="flex gap-3">
                        {complexityLevels.map(level => (
                          <label key={level} className="flex items-center cursor-pointer">
                            <input
                              type="radio"
                              name="complexity"
                              value={level}
                              checked={formData.complexity === level}
                              onChange={(e) => setFormData({ ...formData, complexity: e.target.value })}
                              className="mr-2"
                            />
                            <span className={`px-3 py-1 rounded text-sm font-medium ${
                              formData.complexity === level
                                ? level === 'Low' ? 'bg-green-100 text-green-700' :
                                  level === 'Medium' ? 'bg-yellow-100 text-yellow-700' :
                                  'bg-red-100 text-red-700'
                                : 'bg-slate-100 text-slate-600'
                            }`}>
                              {level}
                            </span>
                          </label>
                        ))}
                      </div>
                    </div>

                    <div className="col-span-2">
                      <label className="block text-sm font-medium text-slate-700 mb-1">Wins</label>
                      <textarea
                        value={formData.wins}
                        onChange={(e) => setFormData({ ...formData, wins: e.target.value })}
                        className="w-full px-3 py-2 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                        rows="2"
                        placeholder="What worked well?"
                      />
                    </div>

                    <div className="col-span-2">
                      <label className="block text-sm font-medium text-slate-700 mb-1">Fails</label>
                      <textarea
                        value={formData.fails}
                        onChange={(e) => setFormData({ ...formData, fails: e.target.value })}
                        className="w-full px-3 py-2 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                        rows="2"
                        placeholder="What didn't work?"
                      />
                    </div>

                    <div className="col-span-2">
                      <label className="block text-sm font-medium text-slate-700 mb-1">Tweak</label>
                      <textarea
                        value={formData.tweak}
                        onChange={(e) => setFormData({ ...formData, tweak: e.target.value })}
                        className="w-full px-3 py-2 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                        rows="2"
                        placeholder="What did you change?"
                      />
                    </div>
                  </div>

                  <div className="flex gap-3 mt-6">
                    <button
                      onClick={resetForm}
                      className="flex-1 px-4 py-2 border border-slate-300 text-slate-700 rounded-lg hover:bg-slate-50 transition-colors"
                    >
                      Cancel
                    </button>
                    <button
                      onClick={handleSubmit}
                      className="flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors"
                    >
                      {editingLog !== null ? 'Update' : 'Add'} Log
                    </button>
                  </div>
                </div>
              </div>
            </div>
          )}
        </div>
      );
    }

    ReactDOM.render(<ConductorLogManager />, document.getElementById('root'));
  </script>
</body>
</html>